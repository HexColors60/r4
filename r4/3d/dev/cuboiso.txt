| cubo isometrico
| PHREDA 2017
^r4/lib/gui.txt

|------------------------------
#xcam 0 #ycam 0 #zcam 5.0

#octvert )( 3072 	| 32 niveles de 3 valores*8 vert
#octvert> 'octvert

#rotsum )( 2048		| 32 niveles de 2 valores*8 vert
#rotsum> 'rotsum

#ymin #nymin
#xmin #nxmin
#zmin #nzmin

#ymax #nymax
#xmax #nxmax
#zmax

#mask

#x0 #y0 #z0
#x1 #y1 #z1
#x2 #y2 #z2
#x4 #y4 #z4

#x7 #y7 #z7	| centro del cubo
#n1 #n2 #n3

|---------------
:id3d3 | id --
	transform swap rot ;

:fillstart | --
	'octvert >b
	0.5 0.5 0.5 id3d3 b!+ b!+ b!+ | 111
	0.5 0.5 -0.5 id3d3 b!+ b!+ b!+ | 110
	0.5 -0.5 0.5 id3d3 b!+ b!+ b!+ | 101
	0.5 -0.5 -0.5 id3d3 b!+ b!+ b!+ | 100
	-0.5 0.5 0.5 id3d3 b!+ b!+ b!+ | 011
	-0.5 0.5 -0.5 id3d3 b!+ b!+ b!+ | 010
	-0.5 -0.5 0.5 id3d3 b!+ b!+ b!+ | 001
	-0.5 -0.5 -0.5 id3d3 b!+ b!+ b!+ | 000
	b>
	'octvert> !
	$ff $ff $ff id3d3 'x0 ! 'y0 ! 'z0 !
	$ff $ff -$ff id3d3 'x1 ! 'y1 ! 'z1 !
	$ff -$ff $ff id3d3 'x2 ! 'y2 ! 'z2 !
	-$ff $ff $ff id3d3 'x4 ! 'y4 ! 'z4 !
	-$ff -$ff -$ff id3d3
	x0 + 2/ 'x7 ! 
	y0 + 2/ 'y7 ! 
	z0 + 2/ 'z7 !
	;

| PERSPECTIVA
:id3d | x y z -- u v
	p3d ;

| ISOMETRICO
:id3d
	pick2 over - 0.02 / ox + >r
	rot + 2/ + 0.02 / oy 2/ + r> swap ;

:fillveciso | --
	octvert> 96 - >b
	'rotsum
	b@+ b@+ b@+ id3d rot !+ !+
	b@+ b@+ b@+ id3d rot !+ !+
	b@+ b@+ b@+ id3d rot !+ !+
	b@+ b@+ b@+ id3d rot !+ !+
	b@+ b@+ b@+ id3d rot !+ !+
	b@+ b@+ b@+ id3d rot !+ !+
	b@+ b@+ b@+ id3d rot !+ !+
	b@+ b@+ b@ id3d rot !+ !+
	'rotsum> ! ;

:getn | n --
	3 << 'rotsum + @+ swap @ swap ;

:drawire
	azul
	0 getn op 1 getn line 3 getn line 2 getn line 0 getn line
	4 getn op 5 getn line 7 getn line 6 getn line 4 getn line
	0 getn op 4 getn line
	1 getn op 5 getn line
	2 getn op 6 getn line
	3 getn op 7 getn line
	;

:calco
	x0 x1 - x7 *
	y0 y1 - y7 * +
	z0 z1 - z7 * +
	dup 'n1 !
	31 >> $1 and
	x0 x2 - x7 *
	y0 y2 - y7 * +
	z0 z2 - z7 * +
	dup 'n2 !
	31 >> $2 and or
	x0 x4 - x7 *
	y0 y4 - y7 * +
	z0 z4 - z7 * +
	dup 'n3 !
	31 >> $4 and or
	$7 xor 'mask !
	;

:dumpvar
	verde
	z0 y0 x0 "x0 %f %f %f " print cr
	z7 y7 x7 "x7 %f %f %f " print cr
	mask "%d " print cr
	n3 n2 n1 "%d %d %d" print cr

	cyan 0 getn 1 box
	blanco mask getn 3 box
	'rotsum >b
	8 ( 1? )( 1-
		b@+ b@+ "%d %d " print cr
		) drop
	;

:freelook
	xymouse
	sh 2/ - 7 << swap
	sw 2/ - neg 7 << swap
	neg mrotx mroty ;

:main
	33
	mark
	show clrscr blanco
		dup "%d" print cr

		Omode
		freelook
		xcam ycam zcam mtrans

		fillstart
		fillveciso
		calco

		dumpvar
		drawire

		[ -0.01 'zcam +! ; ] <up>
		[ 0.01 'zcam +! ; ] <dn>
		[ -0.01 'xcam +! ; ] <le>
		[ 0.01 'xcam +! ; ] <ri>
		[ -0.01 'ycam +! ; ] <pgup>
		[ 0.01 'ycam +! ; ] <pgdn>

		'exit >esc< cminiflecha ;

: main ;