| PHREDA 2017 idea
| dibujo de triangulo por punto medio
| problema: el promedio de una coordenada no llega a todo los puntos
|--------------------------
^r4/lib/gui.txt
^r4/lib/trace.txt

#verlist )( 8192
#verlist> 'verlist

:dumpl
	verlist> 24 - >b
	3 ( 1? )( 1-
		b@+
		$401 not and
		dup $3ff and "%h " print
		dup 10 >> $3ff and "%h " print
		dup 20 >> $3ff and "%h " print
		drop
		b@+
		" %h " print cr
		) drop

	cr allowchome ;

:dumpp | adr
	dup >b
	b@+ "%d " print
	b@+ "%d " print
	b@+ "%d " print
	b@+ "%h " print
	b@+ "%d " print
	b@+ "%d " print
	b@+ "%d " print
	b@+ "%h " print
	b@+ "%d " print
	b@+ "%d " print
	b@+ "%d " print
	b@+ "%h " print

	;

:drawp
	@+
	dup $3ff and
	swap 10 >> $3ff and
	setxy
	@+ a! ;

:10bit2/
	+ 2/ $7fdff and ;

:draw1p
	@+ swap @+ swap 4+ @ >r
	setxy
	r> a! ;

:endtri
	dup draw1p
	dup 16 + draw1p
	dup 32 + draw1p
	48 -
	;

:testt
	dup draw1p
	dup 16 + draw1p
	dup 32 + draw1p ;

| x y z uv
:samep | adr --
	dup @ $ffff0 and
	over 16 + @ $ffff0 and <>? ( drop 0 ; )
	over 32 + @ $ffff0 and <>? ( drop 0 ; )
	drop

	dup 4+ @ $ffff0 and
	over 20 + @ $ffff0 and <>? ( drop 0 ; )
	over 36 + @ $ffff0 and <>? ( drop 0 ; )
	drop
	1 ;


:wait
	show 'exit >esc< ;

#level

:2/1 | o2 o1 -- om ;
	over - dup 31 >> - 2/ + ;

:maketri | adr --		b:src a:des
	dup	@+ b@+ 2/1 a!+ @+ b@+ 2/1 a!+ @+ b@+ 2/1 a!+ @ b@+ colavg a!+
	dup @+ b@+ 2/1 a!+ @+ b@+ 2/1 a!+ @+ b@+ 2/1 a!+ @ b@+ colavg a!+
	@+ b@+ 2/1 a!+ @+ b@+ 2/1 a!+ @+ b@+ 2/1 a!+ @ b@+ colavg a!+ ;

:rectri | adr -- adr
|	testt
|	wait
	samep 1? ( drop endtri ; ) drop

	level 6 >? ( drop endtri ; ) drop

	1 'level +!
	dup 48 + >a dup >b dup maketri
    48 + rectri

	dup 48 + >a dup >b dup 16 + maketri
    48 + rectri

	dup 48 + >a dup >b dup 32 + maketri
    48 + rectri

	dup 48 + >a dup >b
	b> 32 + @ b@+ + 2/ a!+
	b> 32 + @ b@+ + 2/ a!+
	b> 32 + @ b@+ + 2/ a!+
	b> 32 + @ b@+ colavg a!+

	b> 16 - @ b@+ + 2/ a!+
	b> 16 - @ b@+ + 2/ a!+
	b> 16 - @ b@+ + 2/ a!+
	b> 16 - @ b@+ colavg a!+

	b> 16 - @ b@+ + 2/ a!+
	b> 16 - @ b@+ + 2/ a!+
	b> 16 - @ b@+ + 2/ a!+
	b> 16 - @ b@+ colavg a!+

    48 + rectri

    48 -
   	-1 'level +!
	;

:tritest | 'vertez --
	>a 'verlist >b
	a@+ b!+ a@+ b!+ a@+ b!+ a@+ b!+
	a@+ b!+ a@+ b!+ a@+ b!+ a@+ b!+
	a@+ b!+ a@+ b!+ a@+ b!+ a@+ b!+
	'verlist rectri drop
	;

|-------------------------
| x y z uv
#vertex
189 183 0 $ff0000
200 100 0 $ff
60 160 0 $ff00

:main
	33
	mark
	show clrscr
		dup "%d" print cr

		xymouse swap 'vertex !+ !
		'vertex tritest

		'exit >esc<
		;

: main ;
