| PHREDA 2017 idea
| dibujo de triangulo por punto medio
| problema: el promedio de una coordenada no llega a todo los puntos
|--------------------------
^r4/lib/gui.txt
^r4/lib/trace.txt

#verlist )( 8192
#verlist> 'verlist

:dumpl
	verlist> 24 - >b
	3 ( 1? )( 1-
		b@+
		$401 not and
		dup $3ff and "%h " print
		dup 10 >> $3ff and "%h " print
		dup 20 >> $3ff and "%h " print
		drop
		b@+
		" %h " print cr
		) drop ;


:drawp
	@+
	dup $3ff and
	swap 10 >> $3ff and
	setxy
	@+ a! ;

:10bit2/
	+ 2/ $7fdff and ;

:draw1p
	@+
	dup $3ff and
	swap 10 >> $3ff and
	setxy
	@ a! ;

:endtri
	dup draw1p
	dup 8 + draw1p
	dup 16 + draw1p
	24 -
	;

:rectri | adr -- adr
	dup @ $401 not and
	over 8 + @ $401 not and
	pick2 16 + @ $401 not and
	=? ( =? ( drop endtri ; ) dup ) 2drop

	dup 24 + >a
	dup @+ a!+ @ a!+
	dup @ over 8 + @ 10bit2/ a!+
	dup 4+ @ over 12 + @ colavg a!+
	dup @ over 16 + @ 10bit2/ a!+
	dup 4+ @ over 20 + @ colavg a!+
    24 + rectri

	dup 24 + >a
	dup 8 + @ a!+ dup 12 + @ a!+
	dup 8 + @ over @ 10bit2/ a!+
	dup 12 + @ over 4+ @ colavg a!+
	dup 8 + @ over 16 + @ 10bit2/ a!+
	dup 12 + @ over 20 + @ colavg a!+
    24 + rectri

	dup 24 + >a
	dup 16 + @ a!+ dup 20 + @ a!+
	dup 16 + @ over @ 10bit2/ a!+
	dup 20 + @ over 4+ @ colavg a!+
	dup 16 + @ over 8 + @ 10bit2/ a!+
	dup 20 + @ over 12 + @ colavg a!+
    24 + rectri

	dup 24 + >a
	dup 8 + @ over @ 10bit2/ a!+
	dup 12 + @ over 4+ @ colavg a!+
	dup 16 + @ over @ 10bit2/ a!+
	dup 20 + @ over 4+ @ colavg a!+
	dup 16 + @ over 8 + @ 10bit2/ a!+
	dup 20 + @ over 12 + @ colavg a!+
    24 + rectri

    24 -
	;

:tritest | 'vertez --
	>a
	'verlist >b
	a@+ a@+ 10 << or a@+ 20 << or b!+
	a@+ b!+
	a@+ a@+ 10 << or a@+ 20 << or b!+
	a@+ b!+
	a@+ a@+ 10 << or a@+ 20 << or b!+
	a@+ b!+
	'verlist rectri drop
	;

|-------------------------
| x y z uv
#vertex
189 183 0 $ff00ff
200 100 0 $00ff
60 160 0 $ffffff

:main
	33
	mark
	show clrscr
		dup "%d" print cr

|		xymouse swap 'vertex !+ !
		'vertex tritest

		'exit >esc<
		;

: main ;
