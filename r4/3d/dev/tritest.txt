| PHREDA 2017 idea
| dibujo de triangulo por punto medio
| problema: el promedio de una coordenada no llega a todo los puntos
|--------------------------
^r4/lib/gui.txt
^r4/lib/trace.txt

#verlist )( 8192
#verlist> 'verlist

:drawp
	@+
	dup $3ff and
	swap 10 >> $3ff and
	setxy
	@+ a! ;

:level | adr
	dup @
	over 8 + @ <>?
	;

:10bit2/
	+ 2/ $7fdff and ;

:same3 | adr -- adr 1/0
	dup @
	over 8 + @ <>? ( 0 nip ; )
	over 16 + @ <>? ( 0 nip ; )
	1 nip ;

:draw1p
	@+
	dup $3ff and
	swap 10 >> $3ff and
	setxy
	@ a! ;

:dumpl
	verlist> 24 - >b
	3 ( 1? )( 1-
		b@+
		dup $3ff and 2/ "%d " print
		dup 10 >> $3ff and 2/ "%d " print
		dup 20 >> $3ff and 2/ "%d " print
		drop
		b@+
		" %h " print cr
		) drop ;

#l

:rectri | adr --
	1 'l +!
|	same3 1? ( drop draw1p ; ) drop
	l 10 >? ( 2drop ; ) drop

	verlist> >a
	dup @+ a!+ @ a!+
	dup @ over 8 + @ 10bit2/ a!+
	dup 4+ @ over 12 + @ colavg a!+
	dup @ over 16 + @ 10bit2/ a!+
	dup 4+ @ over 20 + @ colavg a!+
    a> 'verlist> !

    dumpl cr
    verlist> 24 - rectri

	drop

	;

:tritest | 'vertez --
	>a
	'verlist >b
	a@+ 2* a@+ 2* 10 << or a@+ 2* 20 << or b!+ a@+ b!+
	a@+ 2* a@+ 2* 10 << or a@+ 2* 20 << or b!+ a@+ b!+
	a@+ 2* a@+ 2* 10 << or a@+ 2* 20 << or b!+ a@+ b!+
	b> 'verlist> !

    dumpl cr

	'verlist rectri
	;

|-------------------------
| x y z uv
#vertex
189 183 0 $ff00ff
200 100 0 $00ff
60 160 0 $ffffff

:main
	33
	mark
	show clrscr
		dup "%d" print cr

        0 'l !
|		xymouse swap 'vertex !+ !
		'vertex tritest

		'exit >esc<
		;

: main ;
