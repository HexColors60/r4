^r4/lib/gui.txt
^r4/lib/btn.txt

^r4/lib/part16.txt
^r4/lib/anima.txt
^r4/3d/octree/iso_13.txt

^r4/lib/trace.txt

|-------------
::zdraw | x y --
	setxy
	zb >r
	sw w3do -
	h3do ( 1? )( 1-
		w3do ( 1? )( 1-
			r@+
			|$7fffffff <>? ( drop r zbo + @ px!+ )( drop 1 px+! )	| cbuffer
			$7fffffff =? ( drop 1 px+! )( px!+ )	| zbuffer
			) drop
		over px+!
		) 2drop rdrop ;

|-------------
#xcam 0 #ycam 0 #zcam 2.0

|-------------
:3dop transform p3d op ;
:3dline transform p3d line ;

|-------------
:freelook
	xymouse
	sh 2/ - 7 << swap
	sw 2/ - neg 7 << swap
	neg mrotx mroty
	;

|-------------
#sizx #sizy #sizz

:drawz | z --
	sizx neg sizy neg pick2 3dop
	sizx sizy neg pick2 3dline
	sizx sizy pick2 3dline
	sizx neg sizy pick2 3dline
	sizx neg sizy neg rot 3dline ;

:drawl | x1 x2 --
	2dup sizz neg 3dop sizz 3dline ;

:box3d | sx sy sz --
	'sizz ! 'sizy ! 'sizx !
	sizz neg drawz sizz drawz
	sizx neg sizy neg drawl sizx sizy neg drawl
	sizx sizy drawl sizx neg sizy drawl
	;

|-------------
#nline 300

:dpoint | nro val -- nro
	8 >> sh 1- clamp0max
	over swap setxy $ff0000 px!+
	;

:dumpline
	verde
	0 nline op sw nline line
	zb nline w3do * 2 << +
	>r
	0 ( sw <? )(
     	r@+ dpoint
		1+ ) drop
	rdrop
	;


|-------------
#Otierra

#fps
#fpsc
#mseca

:main
	mark
	sw sh ini3do
|	"media/3do/earth.3do"
	"media/3do/mario.3do"
	load3do 'Otierra !
	33
	show clrscr

		matini
|		freelook
		xcam ycam zcam mtrans

       -0.25 mrotzi
		msec 3 << mrotxi

		zb.clear
		Otierra drawoctree
		0 0 zdraw


		1 'fpsc +!

		verde fonti
		dup "%d " print cr
		msec fps over mseca - "%d ms fps:%d" print cr 'mseca !
		zcam ycam xcam "%f %f %f" print cr

        dumpline

		[ -1 'nline +! ; ] <up>
		[ 1 'nline +! ; ] <dn>

		'exit >esc< cminiflecha
		1000 .mseg .restart
		fpsc 'fps ! 0 'fpsc !
		;

: main ;
