| anima
| PHREDA2016
|---------------
^r4/lib/gui.txt
^r4/lib/3dmat.txt
^r4/lib/trace.txt

#xcam 0 #ycam 0 #zcam 2.0
#xr 0 #yr 0


|/** Human animation object. */
#obj_human
| Base everything
	0 0 0	| x y z
	0 0 0	| dx dy dz
	$0		| color
	1 3		| index count
| Human body.
	0 -7 0
	11 20 6
	$ff00
	3 3
| Human left leg.
	-3 -7 0
	5 10 5
	$ff0000
	5 1
| Human right leg.
	3 -7 0
	5 10 5
	$ff0000
	5 1
| Human head.
	0 0 0
	7 7 7
	$ff
	0 0
| Human left arm.
	-6 0 0
	4 12 4
	$ff0000
	4 1
| Human right arm.
	6 0 0
	4 12 4
	$ff0000
	4 1
| Human left foot.
	0 0 0
	5 10 5
	$ff
	0 0
| Human right foot.
	0 0 0
	5 10 5
	$ff
	0 0
| Human left hand.
	0 0 0
	4 12 4
	$ff
	0 0
| Human right hand.
	0 0 0
	4 12 4
	$ff
	0 0

#anim_human
| Stand.
	|0 0 8 8 0 73 -55 0 0 15 15
| Walk 1.
  |0 0 7 10 0 57 -71 15 15 -33 47
	0 0 7 10 0 57 55 15 15 -33 33
| Walk 2.
  |0 0 10 7 0 89 -39 15 15 -33 62
	0 0 10 7 0 89 71 15 15 -33 50
| Look left.
	|0 16 24 8 16 89 -87 0 0 -33 46
	0 16 24 8 16 89 55 0 0 -33 34
| Look right up.
	|0 -15 8 -8 -15 105 -87 0 0 -17 77
	0 -15 8 -8 -15 105 55 0 0 -17 66
| Clap back.
	|0 0 25 -7 0 26 -7 15 15 -68 109
	|0 0 25 -7 0 26 -23 15 15 -68 109
	0 0 25 -7 0 26 87 15 15 -68 68
| Clap front.
	|0 0 25 -7 0 10 -7 15 15 -67 109
	0 0 25 -7 0 10 103 15 15 -67 84
| Pose left.
	|0 16 41 -7 -15 47 22 0 15 -64 -83
	|0 16 41 -7 -15 47 -118 0 15 -64 -108
	0 16 41 -7 -15 63 22 0 15 -64 37
| Pose right.
	|0 -16 26 -39 16 39 -34 14 0 4 -128
	|0 -16 26 -39 16 7 -34 14 0 123 -128
| Point front.
	|0 15 41 -23 1 13 39 15 15 -64 -85
| Break backwards.
	19 0 43 -39 -1 76 67 60 -19 -94 -49
| Break forwards.
	|-18 -1 11 -67 18 28 84 15 15 66 -20
	-18 -1 11 -34 18 28 84 15 15 66 -20
| Handstand.
	7 1 25 -7 1 79 65 12 14 -113 15
| Landing.
	0 15 27 -4 1 75 69 10 10 81 33
| Cartwheel start.
	16 0 42 9 0 75 65 15 47 65 65
| Cartwheel middle.
	-128 0 26 -23 0 95 65 27 15 17 114
| Cartwheel end.
	-16 16 40 -38 -16 58 69 -17 15 82 50
| Bow start.
	|0 0 8 8 1 25 70 0 0 4 -128
	0 0 8 8 0 105 -37 0 0 -21 -128
| Bow end.
	|0 13 8 8 15 -7 85 0 0 51 81
	0 13 8 8 14 26 -54 0 0 -37 79
| Megaman kneel start.
	|0 0 44 -4 1 89 38 10 10 86 54
	0 0 28 -4 2 89 -103 10 10 -53 26
| Megaman jump.
	|0 0 43 -7 1 48 39 11 15 64 52
	0 0 27 -7 1 64 -70 10 15 -112 59
| Mosh up.
	|0 0 25 -7 0 105 81 15 15 -20 0
	0 0 25 -23 -15 105 82 15 0 -20 0
| Mosh down.
	0 15 25 -7 14 106 80 15 15 -20 0
| Retarded right.
	0 -16 25 -7 1 106 39 0 15 -20 53
| Retarded left.
	0 16 25 -23 15 57 23 15 0 -52 52
| Back roll start.
	2 0 43 -5 15 122 5 15 14 -20 20
| Back roll middle.
	|8 15 29 -3 13 92 52 10 10 -4 19
	8 15 29 -3 13 92 52 10 10 -1 17
| Back roll end.
	15 1 27 -4 1 106 38 10 11 -35 52
| Bounce.
	5 1 26 -6 15 110 34 15 15 -3 19
| Pose front.
	0 -32 41 -39 32 43 -7 0 0 -113 1

|brief Location data block.
|
| This specifies the 'location', 'speed' and other things related to
| animating the model.
|
| Format:
| Speed until next block (3)
| Animation index this block (1)
| Animation speed (1)
| Animation power (1)
| Animation cycle count (1)
|
| Speed is actually divided to very small amounts.
|
| The animation speed is multiplied by 8 in actual animation terms.
| Higher is slower, as it represents the divisor for tick. Negative value
| means going 'backwards'.
|
| Animation power represents the power the sine is multiplied to before
| applying. It should mostly be 1, but any number is valid in theory.
|
| The animation cycle count represents the number of cycles this animation
| passes before we move onto the next block. This way, the animation frames
| are cumulative and not tied to exact time steps but rather the number of
| cycles in the distinct locators. Number of 1 means one pass from start to
| finish, number 2 would be a pass back to the start again.
|
#location_human
	0 0 -80 0 25 1 17 | Begin walk
	0 0 0 1 60 1 1
	0 0 0 2 127 1 1
	0 -5 0 3 40 1 1
	0 0 0 4 10 1 23 | Clapping
	0 0 0 5 60 3 1
	0 0 0 26 40 3 1
	0 0 0 5 20 3 1
	0 0 0 6 40 3 1
	0 0 0 5 20 3 1
	0 0 0 18 20 3 19
	0 0 0 19 40 3 1 | Retarded
	0 0 0 20 40 3 7
	0 -44 16 21 31 0 1 | Begin back roll
	0 26 18 22 20 0 1 
	0 12 68 23 29 0 1
	0 -35 30 24 22 0 1
	0 16 18 22 31 0 1
	0 20 -15 23 27 0 1
	0 7 -70 25 45 0 1
	0 0 0 18 26 3 13 | Mosh again
	0 0 0 19 20 1 1
	0 0 0 20 26 3 13 | Retarded again
	0 -26 0 21 45 1 1 | Begin drop
	0 13 33 7 30 1 1
	0 55 -48 8 30 1 1
	0 -51 -33 9 35 1 1
	0 25 0 10 30 1 1
	-60 32 0 11 30 1 1
	-60 -24 0 12 30 1 1
	0 0 0 13 40 1 1
	0 0 0 6 20 1 1
	60 24 0 13 30 1 1
	60 -28 0 12 30 1 1
	0 0 0 11 40 1 1
	0 0 0 18 60 1 1
	0 0 0 14 90 3 1
	0 -10 0 15 80 0 1
	0 127 0 16 20 1 1
	0 127 0 17 127 1 1
	0 127 0 17 127 1 1


:3dop project3d op ;
:3dline project3d line ;

:drawboxz | z --
	-0.1 -0.1 pick2 3dop
	0.1 -0.1 pick2 3dline
	0.1 0.1 pick2 3dline
	-0.1 0.1 pick2 3dline
	-0.1 -0.1 rot 3dline ;

:drawlinez | x1 x2 --
	2dup -0.1 3dop 0.1 3dline ;

:drawcube |
	-0.1 drawboxz
	0.1 drawboxz
	-0.1 -0.1 drawlinez
	0.1 -0.1 drawlinez
	0.1 0.1 drawlinez
	-0.1 0.1 drawlinez ;

:freelook
	xymouse
	sh 2/ - 7 << swap
	sw 2/ - neg 7 << swap
	neg mrotx
	mroty ;

:3dscreen
	omode
	freelook
	xcam ycam zcam mtrans

	drawcube
	;


#dx #dy #dz
:drawbox
	mpush
	0 dy 2/ 0 mtransi
	dx dy dz mscalei
	drawcube
	mpop
	0 dy 0 mtransi
	;
:drawcobj | obj c --
	>r ( 1? )(
		mpush
		r@+ 0.01 * r@+ 0.01 * r@+ 0.01 * mtransi
		r@+ 0.01 * 'dx ! r@+ 0.01 * 'dy ! r@+ 0.01 * 'dz !
		r@+ ink
		drawbox
		r@+ r@+ swap
		1? ( 1- 9 2 << * r + drawcobj )( 2drop )
		mpop
		1- ) drop
	rdrop
	;


:main
	33
	show clrscr
		dup "%d" print
		3dscreen

|        'anim_human
		1 'obj_human drawcobj
		'exit >esc<

		cminiflecha
		;

:ini
	mark
	;

: ini main ;